{"version":3,"file":"bundle.js","sources":["../node_modules/browserify/node_modules/browser-pack/_prelude.js","../lib/index.js","../lib/Mapper.js","../node_modules/browserify/node_modules/events/events.js","../lib/packers/index.js","../lib/packers/JsonRPC.js","../lib/packers/XmlRPC.js","../node_modules/inherits/inherits_browser.js"],"names":["unifyResponseMethods","responseMethods","key","value","response","unifyTransport","transport","Function","send","bind","postMessage","undefined","onmessage","SyntaxError","RpcNotification","method","params","Object","defineProperty","this","enumerable","RpcBuilder","packer","options","onRequest","transportMessage","event","message","self","decode","data","emit","storeResponse","id","dest","timeout","setTimeout","responses","remove","response_timeout","set","storeProcessedResponse","ack","from","processedResponses","duplicates_timeout","RpcRequest","call","get","Boolean","responseMethod","pack","reply","error","result","clearTimeout","peerID","cancel","message2Key","request","requests","pop","unpack","EventEmitter","on","max_retries","removeEventListener","addEventListener","request_timeout","BASE_TIMEOUT","requestID","Mapper","inherits","close","forEach","encode","callback","dispatchCallback","sendRequest","Math","pow","retried","encode_transport","retry","console","warn","Error","processRequest","idAck","processResponse","duplicatedResponse","TypeError","e","debug","processed","sessionID","require","packers","module","exports","sources","source","key2","ids","keys","length","prototype","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","type","er","handler","len","args","i","listeners","arguments","Array","apply","slice","addListener","listener","m","newListener","push","warned","trace","once","g","removeListener","fired","list","position","splice","removeAllListeners","ret","listenerCount","emitter","JsonRPC","XmlRPC","jsonrpc","JSON","stringify","String","parse","version","result_defined","error_defined","create","ctor","superCtor","super_","constructor","writable","configurable","TempCtor"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*\n * (C) Copyright 2014 Kurento (http://kurento.org/)\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the GNU Lesser General Public License\n * (LGPL) version 2.1 which accompanies this distribution, and is available at\n * http://www.gnu.org/licenses/lgpl-2.1.html\n *\n * This library is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n * Lesser General Public License for more details.\n *\n */\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar inherits = require('inherits');\n\nvar packers = require('./packers');\nvar Mapper = require('./Mapper');\n\n\nconst BASE_TIMEOUT = 5000;\n\n\nfunction unifyResponseMethods(responseMethods)\n{\n  if(!responseMethods) return {};\n\n  for(var key in responseMethods)\n  {\n    var value = responseMethods[key];\n\n    if(typeof value == 'string')\n      responseMethods[key] =\n      {\n        response: value\n      }\n  };\n\n  return responseMethods;\n};\n\nfunction unifyTransport(transport)\n{\n  if(!transport) return;\n\n  if(transport instanceof Function)\n    return transport;\n\n  if(transport.send instanceof Function)\n    return transport.send.bind(transport);\n\n  if(transport.postMessage instanceof Function)\n    return transport.postMessage.bind(transport);\n\n  // Transports that only can receive messages, but not send\n  if(transport.onmessage !== undefined) return;\n\n  throw new SyntaxError(\"Transport is not a function nor a valid object\");\n};\n\n\n/**\n * Representation of a RPC notification\n *\n * @class\n *\n * @constructor\n *\n * @param {String} method -method of the notification\n * @param params - parameters of the notification\n */\nfunction RpcNotification(method, params)\n{\n  Object.defineProperty(this, 'method', {value: method, enumerable: true});\n  Object.defineProperty(this, 'params', {value: params, enumerable: true});\n};\n\n\n/**\n * @class\n *\n * @constructor\n */\nfunction RpcBuilder(packer, options, transport, onRequest)\n{\n  var self = this;\n\n  if(!packer)\n    throw new SyntaxError('Packer is not defined');\n\n  if(!packer.pack || !packer.unpack)\n    throw new SyntaxError('Packer is invalid');\n\n  var responseMethods = unifyResponseMethods(packer.responseMethods);\n\n\n  if(options instanceof Function || options && options.send instanceof Function)\n  {\n    if(transport && !(transport instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n    onRequest = transport;\n    transport = options;\n    options   = undefined;\n  };\n\n  if(transport instanceof Function\n  || transport && transport.send instanceof Function)\n    if(onRequest && !(onRequest instanceof Function))\n      throw new SyntaxError(\"Only a function can be after transport\");\n\n  options = options || {};\n\n\n  EventEmitter.call(this);\n\n  if(onRequest)\n    this.on('request', onRequest);\n\n\n  Object.defineProperty(this, 'peerID', {value: options.peerID});\n\n  var max_retries = options.max_retries || 0;\n\n\n  function transportMessage(event)\n  {\n    var message = self.decode(event.data);\n    if(message)\n      self.emit('request', message);\n  };\n\n  Object.defineProperty(this, 'transport',\n  {\n    get: function()\n    {\n      return transport;\n    },\n\n    set: function(value)\n    {\n      // Remove listener from old transport\n      if(transport && transport.onmessage !== undefined)\n        transport.removeEventListener('message', transportMessage);\n\n      // Set listener on new transport\n      if(value && value.onmessage !== undefined)\n        value.addEventListener('message', transportMessage);\n\n      transport = unifyTransport(value);\n    }\n  })\n\n  this.transport = transport;\n\n\n  const request_timeout    = options.request_timeout    || BASE_TIMEOUT;\n  const response_timeout   = options.response_timeout   || BASE_TIMEOUT;\n  const duplicates_timeout = options.duplicates_timeout || BASE_TIMEOUT;\n\n\n  var requestID = 0;\n\n  var requests  = new Mapper();\n  var responses = new Mapper();\n  var processedResponses = new Mapper();\n\n  var message2Key = {};\n\n\n  /**\n   * Store the response to prevent to process duplicate request later\n   */\n  function storeResponse(message, id, dest)\n  {\n    var response =\n    {\n      message: message,\n      /** Timeout to auto-clean old responses */\n      timeout: setTimeout(function()\n      {\n        responses.remove(id, dest);\n      },\n      response_timeout)\n    };\n\n    responses.set(response, id, dest);\n  };\n\n  /**\n   * Store the response to ignore duplicated messages later\n   */\n  function storeProcessedResponse(ack, from)\n  {\n    var timeout = setTimeout(function()\n    {\n      processedResponses.remove(ack, from);\n    },\n    duplicates_timeout);\n\n    processedResponses.set(timeout, ack, from);\n  };\n\n\n  /**\n   * Representation of a RPC request\n   *\n   * @class\n   * @extends RpcNotification\n   *\n   * @constructor\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param {Integer} id - identifier of the request\n   * @param [from] - source of the notification\n   */\n  function RpcRequest(method, params, id, from, transport)\n  {\n    RpcNotification.call(this, method, params);\n\n    Object.defineProperty(this, 'transport',\n    {\n      get: function()\n      {\n        return transport;\n      },\n\n      set: function(value)\n      {\n        transport = unifyTransport(value);\n      }\n    })\n\n    var response = responses.get(id, from);\n\n    /**\n     * @constant {Boolean} duplicated\n     */\n    if(!(transport || self.transport))\n      Object.defineProperty(this, 'duplicated',\n      {\n        value: Boolean(response)\n      });\n\n    var responseMethod = responseMethods[method];\n\n    this.pack = function()\n    {\n      return packer.pack(this, id);\n    }\n\n    /**\n     * Generate a response to this request\n     *\n     * @param {Error} [error]\n     * @param {*} [result]\n     *\n     * @returns {string}\n     */\n    this.reply = function(error, result, transport)\n    {\n      // Fix optional parameters\n      if(error instanceof Function || error && error.send instanceof Function)\n      {\n        if(result != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = error;\n        result = null;\n        error = undefined;\n      }\n\n      else if(result instanceof Function\n      || result && result.send instanceof Function)\n      {\n        if(transport != undefined)\n          throw new SyntaxError(\"There can't be parameters after callback\");\n\n        transport = result;\n        result = null;\n      };\n\n      transport = unifyTransport(transport);\n\n      // Duplicated request, remove old response timeout\n      if(response)\n        clearTimeout(response.timeout);\n\n      if(from != undefined)\n      {\n        if(error)\n          error.dest = from;\n\n        if(result)\n          result.dest = from;\n      };\n\n      var message;\n\n      // New request or overriden one, create new response with provided data\n      if(error || result != undefined)\n      {\n        if(self.peerID != undefined)\n        {\n          if(error)\n            error.from = self.peerID;\n          else\n            result.from = self.peerID;\n        }\n\n        // Protocol indicates that responses has own request methods\n        if(responseMethod)\n        {\n          if(responseMethod.error == undefined && error)\n            message =\n            {\n              error: error\n            };\n\n          else\n          {\n            var method = error\n                       ? responseMethod.error\n                       : responseMethod.response;\n\n            message =\n            {\n              method: method,\n              params: error || result\n            };\n          }\n        }\n        else\n          message =\n          {\n            error:  error,\n            result: result\n          };\n\n        message = packer.pack(message, id);\n      }\n\n      // Duplicate & not-overriden request, re-send old response\n      else if(response)\n        message = response.message;\n\n      // New empty reply, response null value\n      else\n        message = packer.pack({result: null}, id);\n\n      // Store the response to prevent to process a duplicated request later\n      storeResponse(message, id, from);\n\n      // Return the stored response so it can be directly send back\n      transport = transport || this.transport || self.transport;\n\n      if(transport)\n        return transport(message);\n\n      return message;\n    }\n  };\n  inherits(RpcRequest, RpcNotification);\n\n\n  function cancel(message)\n  {\n    var key = message2Key[message];\n    if(!key) return;\n\n    delete message2Key[message];\n\n    var request = requests.pop(key.id, key.dest);\n    if(!request) return;\n\n    clearTimeout(request.timeout);\n\n    // Start duplicated responses timeout\n    storeProcessedResponse(key.id, key.dest);\n  };\n\n  /**\n   * Allow to cancel a request and don't wait for a response\n   *\n   * If `message` is not given, cancel all the request\n   */\n  this.cancel = function(message)\n  {\n    if(message) return cancel(message);\n\n    for(var message in message2Key)\n      cancel(message);\n  };\n\n\n  this.close = function()\n  {\n    // Prevent to receive new messages\n    var transport = self.transport;\n    if(transport && transport.close)\n       transport.close();\n\n    // Request & processed responses\n    this.cancel();\n\n    processedResponses.forEach(function(timeout)\n    {\n      clearTimeout(timeout);\n    });\n\n    // Responses\n    responses.forEach(function(response)\n    {\n      clearTimeout(response.timeout);\n    });\n  };\n\n\n  /**\n   * Generates and encode a JsonRPC 2.0 message\n   *\n   * @param {String} method -method of the notification\n   * @param params - parameters of the notification\n   * @param [dest] - destination of the notification\n   * @param {object} [transport] - transport where to send the message\n   * @param [callback] - function called when a response to this request is\n   *   received. If not defined, a notification will be send instead\n   *\n   * @returns {string} A raw JsonRPC 2.0 request or notification string\n   */\n  this.encode = function(method, params, dest, transport, callback)\n  {\n    // Fix optional parameters\n    if(params instanceof Function)\n    {\n      if(dest != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = params;\n      transport = undefined;\n      dest      = undefined;\n      params    = undefined;\n    }\n\n    else if(dest instanceof Function)\n    {\n      if(transport != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = dest;\n      transport = undefined;\n      dest      = undefined;\n    }\n\n    else if(transport instanceof Function)\n    {\n      if(callback != undefined)\n        throw new SyntaxError(\"There can't be parameters after callback\");\n\n      callback  = transport;\n      transport = undefined;\n    };\n\n    if(self.peerID != undefined)\n    {\n      params = params || {};\n\n      params.from = self.peerID;\n    };\n\n    if(dest != undefined)\n    {\n      params = params || {};\n\n      params.dest = dest;\n    };\n\n    // Encode message\n    var message =\n    {\n      method: method,\n      params: params\n    };\n\n    if(callback)\n    {\n      var id = requestID++;\n      var retried = 0;\n\n      message = packer.pack(message, id);\n\n      var request =\n      {\n        message:         message,\n        callback:        dispatchCallback,\n        responseMethods: responseMethods[method] || {}\n      };\n\n      function dispatchCallback(error, result)\n      {\n        self.cancel(message);\n\n        callback(error, result);\n      };\n\n      var encode_transport = unifyTransport(transport);\n\n      function sendRequest(transport)\n      {\n        request.timeout = setTimeout(timeout,\n                                     request_timeout*Math.pow(2, retried++));\n        message2Key[message] = {id: id, dest: dest};\n        requests.set(request, id, dest);\n\n        transport = transport || encode_transport || self.transport;\n        if(transport)\n          return transport(message);\n\n        return message;\n      };\n\n      function retry(transport)\n      {\n        transport = unifyTransport(transport);\n\n        console.warn(retried+' retry for request message:',message);\n\n        var timeout = processedResponses.pop(id, dest);\n        clearTimeout(timeout);\n\n        return sendRequest(transport);\n      };\n\n      function timeout()\n      {\n        if(retried < max_retries)\n          return retry(transport);\n\n        var error = new Error('Request has timed out');\n            error.request = message;\n\n        error.retry = retry;\n\n        dispatchCallback(error)\n      };\n\n      return sendRequest(transport);\n    };\n\n    // Return the packed message\n    message = packer.pack(message);\n\n    transport = transport || self.transport;\n    if(transport)\n      return transport(message);\n\n    return message;\n  };\n\n  /**\n   * Decode and process a JsonRPC 2.0 message\n   *\n   * @param {string} message - string with the content of the message\n   *\n   * @returns {RpcNotification|RpcRequest|undefined} - the representation of the\n   *   notification or the request. If a response was processed, it will return\n   *   `undefined` to notify that it was processed\n   *\n   * @throws {TypeError} - Message is not defined\n   */\n  this.decode = function(message, transport)\n  {\n    if(!message)\n      throw new TypeError(\"Message is not defined\");\n\n    try\n    {\n      message = packer.unpack(message);\n    }\n    catch(e)\n    {\n      // Ignore invalid messages\n      return console.debug(e, message);\n    };\n\n    var id     = message.id;\n    var ack    = message.ack;\n    var method = message.method;\n    var params = message.params || {};\n\n    var from = params.from;\n    var dest = params.dest;\n\n    // Ignore messages send by us\n    if(self.peerID != undefined && from == self.peerID) return;\n\n    // Notification\n    if(id == undefined && ack == undefined)\n      return new RpcNotification(method, params);\n\n\n    function processRequest()\n    {\n      // If we have a transport and it's a duplicated request, reply inmediatly\n      transport = unifyTransport(transport) || self.transport;\n      if(transport)\n      {\n        var response = responses.get(id, from);\n        if(response)\n          return transport(response.message);\n      };\n\n      var idAck = (id != undefined) ? id : ack;\n      return new RpcRequest(method, params, idAck, from, transport);\n    };\n\n    function processResponse(request, error, result)\n    {\n      request.callback(error, result);\n    };\n\n    function duplicatedResponse(timeout)\n    {\n      console.warn(\"Response already processed\", message);\n\n      // Update duplicated responses timeout\n      clearTimeout(timeout);\n      storeProcessedResponse(ack, from);\n    };\n\n\n    // Request, or response with own method\n    if(method)\n    {\n      // Check if it's a response with own method\n      if(dest == undefined || dest == self.peerID)\n      {\n        var request = requests.get(ack, from);\n        if(request)\n        {\n          var responseMethods = request.responseMethods;\n\n          if(method == responseMethods.error)\n            return processResponse(request, params);\n\n          if(method == responseMethods.response)\n            return processResponse(request, null, params);\n\n          return processRequest();\n        }\n\n        var processed = processedResponses.get(ack, from);\n        if(processed)\n          return duplicatedResponse(processed);\n      }\n\n      // Request\n      return processRequest();\n    };\n\n    var error  = message.error;\n    var result = message.result;\n\n    // Ignore responses not send to us\n    if(error  && error.dest  && error.dest  != self.sessionID) return;\n    if(result && result.dest && result.dest != self.sessionID) return;\n\n    // Response\n    var request = requests.get(ack, from);\n    if(!request)\n    {\n      var processed = processedResponses.get(ack, from);\n      if(processed)\n        return duplicatedResponse(processed);\n\n      return console.warn(\"No callback was defined for this message\", message);\n    };\n\n    // Process response\n    processResponse(request, error, result);\n  };\n};\ninherits(RpcBuilder, EventEmitter);\n\n\nRpcBuilder.RpcNotification = RpcNotification;\n\n\nmodule.exports = RpcBuilder;\n\nRpcBuilder.packers = packers;\n","function Mapper()\n{\n  var sources = {};\n\n\n  this.forEach = function(callback)\n  {\n    for(var key in sources)\n    {\n      var source = sources[key];\n\n      for(var key2 in source)\n        callback(source[key2]);\n    };\n  };\n\n  this.get = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return undefined;\n\n    return ids[id];\n  };\n\n  this.remove = function(id, source)\n  {\n    var ids = sources[source];\n    if(ids == undefined)\n      return;\n\n    delete ids[id];\n\n    if(!Object.keys(ids).length)\n      delete sources[source];\n  };\n\n  this.set = function(value, id, source)\n  {\n    if(value == undefined)\n      return this.remove(id, source);\n\n    var ids = sources[source];\n    if(ids == undefined)\n      sources[source] = ids = {};\n\n    ids[id] = value;\n  };\n};\n\n\nMapper.prototype.pop = function(id, source)\n{\n  var value = this.get(id, source);\n  if(value == undefined)\n    return undefined;\n\n  this.remove(id, source);\n\n  return value;\n};\n\n\nmodule.exports = Mapper;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        throw TypeError('Uncaught, unspecified \"error\" event.');\n      }\n      return false;\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var JsonRPC = require('./JsonRPC');\nvar XmlRPC  = require('./XmlRPC');\n\n\nexports.JsonRPC = JsonRPC;\nexports.XmlRPC  = XmlRPC;\n","/**\n * JsonRPC 2.0 packer\n */\n\n/**\n * Pack a JsonRPC 2.0 message\n *\n * @param {Object} message - object to be packaged. It requires to have all the\n *   fields needed by the JsonRPC 2.0 message that it's going to be generated\n *\n * @return {String} - the stringified JsonRPC 2.0 message\n */\nfunction pack(message, id)\n{\n  var result =\n  {\n    jsonrpc: \"2.0\"\n  };\n\n  // Request\n  if(message.method)\n  {\n    result.method = message.method;\n\n    if(message.params)\n      result.params = message.params;\n\n    // Request is a notification\n    if(id != undefined)\n      result.id = id;\n  }\n\n  // Response\n  else if(id != undefined)\n  {\n    if(message.error)\n    {\n      if(message.result !== undefined)\n        throw new TypeError(\"Both result and error are defined\");\n\n      result.error = message.error;\n    }\n    else if(message.result !== undefined)\n      result.result = message.result;\n    else\n      throw new TypeError(\"No result or error is defined\");\n\n    result.id = id;\n  };\n\n  return JSON.stringify(result);\n};\n\n/**\n * Unpack a JsonRPC 2.0 message\n *\n * @param {String} message - string with the content of the JsonRPC 2.0 message\n *\n * @throws {TypeError} - Invalid JsonRPC version\n *\n * @return {Object} - object filled with the JsonRPC 2.0 message content\n */\nfunction unpack(message)\n{\n  var result = message;\n\n  if(typeof message == 'string' || message instanceof String)\n    result = JSON.parse(message);\n\n  // Check if it's a valid message\n\n  var version = result.jsonrpc;\n  if(version != \"2.0\")\n    throw new TypeError(\"Invalid JsonRPC version '\"+version+\"': \"+message);\n\n  // Response\n  if(result.method == undefined)\n  {\n    if(result.id == undefined)\n      throw new TypeError(\"Invalid message: \"+message);\n\n    var result_defined = result.result !== undefined;\n    var error_defined  = result.error  !== undefined;\n\n    // Check only result or error is defined, not both or none\n    if(result_defined && error_defined)\n      throw new TypeError(\"Both result and error are defined: \"+message);\n\n    if(!result_defined && !error_defined)\n      throw new TypeError(\"No result or error is defined: \"+message);\n\n    result.ack = result.id;\n    delete result.id;\n  }\n\n  // Return unpacked message\n  return result;\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","function pack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\nfunction unpack(message)\n{\n  throw new TypeError(\"Not yet implemented\");\n};\n\n\nexports.pack   = pack;\nexports.unpack = unpack;\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n"]}